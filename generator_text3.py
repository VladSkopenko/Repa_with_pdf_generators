from t import split_sections

class ContractTemplateRussia:
    def __init__(
        self,
        contract_number,
        date,
        seller_name,
        seller_representative,
        buyer_name,
        buyer_representative,
    ):
        self.contract_number = contract_number
        self.date = date
        self.seller_name = seller_name
        self.seller_representative = seller_representative
        self.buyer_name = buyer_name
        self.buyer_representative = buyer_representative

    def render_header(self):
        return (
            f"КОНТРАКТ № C-W {self.contract_number}\n"
            f"{self.date}"
        )

    def render_parties(self):
        return (
            f"Настоящий Контракт (далее — \"Контракт\") заключён между компанией"
            f"{self.buyer_name}(\"Покупатель\") в лице {self.buyer_representative}, действующего на основании Устава компании, с одной стороны, и {self.seller_name} (\"Продавец\") в лице директора {self.seller_representative}, действующего на основании Устава компании.\n\n"
            f"Принимая во внимание условия и положения, содержащиеся в этом документе, стороны договорились о нижеследующем:"
        )

    def render_goods(self, product_description, production_year):
        return (
            "1.1. В порядке и на условиях, определённых настоящим Контрактом, Продавец продаёт, а Покупатель принимает и оплачивает сельскохозяйственную продукцию, а именно:\n"
            f"{product_description}, {production_year} года производства (далее — \"Товар\").\n"
        )

    def render_quantity_sections(self, quantity, tolerance):
        return [
            {"text": "2.1. Единица измерения количества Товара — метрическая тонна (1000 кг).", "bold": False},
            {"text": f"2.2. Общее количество: {quantity} МТ +/- {tolerance}% на выбор Продавца.", "bold": False},
            {"text": "2.3. Вес поставленного Товара окончательно определяется по результатам взвешивания после прибытия на место доставки. Вид транспорта: грузовой транспорт.", "bold": False},
            {"text": "2.4. Количество Товара определяется по весу при разгрузке автотранспорта и/или железнодорожных вагонов на месте доставки: лабораторией Терминала. Продавец имеет право назначить своих представителей, за свой счёт, для контроля количества Товара при разгрузке. Если Продавец не обеспечит своевременное присутствие своих представителей, разгрузка грузового транспорта будет осуществляться без них, а данные о количестве разгруженного Товара, определённые взвешиванием на месте доставки, признаются обеими Сторонами Контракта.", "bold": False},
            {"text": "2.5. Если при взвешивании вагона на станции назначения выявляется расхождение между брутто-весом в железнодорожной накладной и перегрузочным весом более 0,5%, Покупатель уведомляет о таком расхождении письменно в течение 1 (одного) часа, отправив сообщение на электронный адрес, указанный в Контракте, а вагон разгружается только на основании письменного разрешения, которое Продавец предоставляет в течение 4 (четырёх) часов Покупателю, отправив сообщение на электронный адрес, указанный в этом Контракте. Покупатель имеет право согласиться на место, указанное здесь, или направить своего представителя для контрольного взвешивания Товара, а представитель Продавца прибудет в течение 12 часов с момента уведомления о недостаче.", "bold": False},
            {"text": "В случае недопоставки согласованного количества Товара Продавец обязуется:", "bold": False},
            {"text": "-     поставить недостающий Товар в течение 3 дней;", "bold": False},
            {"text": "-   если оплата произведена, вернуть Покупателю деньги в течение 3 дней с даты соответствующего требования Покупателя.", "bold": False},
            {"text": "Дополнительно Покупатель имеет право приобрести недостающее количество Товара у других контрагентов. Продавец обязан компенсировать стоимость такого Товара и транспортно-логистические расходы в течение 3 дней с даты письменного требования Покупателя.\n", "bold": False},
        ]

    def render_quality_sections(self, metrics: list[str]):
        sections = [
            {"text": "\n3. КАЧЕСТВО И СОСТОЯНИЕ ТОВАРА:", "bold": True},
            {"text": "3.1. Качество Товара по настоящему Контракту должно соответствовать следующим показателям:\n", "bold": False},
        ]
        for metric in metrics:
            sections.append({"text": metric, "bold": False})
        sections.extend([
            {"text": "Амброзия не принимается.", "bold": False},
            {"text": "Все показатели качества должны определяться в соответствии со стандартами ISO, ICC и ЕС.", "bold": False},
            {"text": "3.2. Товар должен быть высокого качества, пригодным для продажи, без посторонних/неприятных запахов, без клещевины или других токсичных семян. Кроме того, Товар не должен содержать посторонних предметов, таких как стекло, металл и т.д. Товар не должен содержать ГМО в соответствии с нормативными актами и должен соответствовать стандартам ЕС по пестицидам/остаткам/тяжёлым металлам и микотоксинам. Товар должен быть без живых насекомых, без посторонних запахов или загрязнений, сохраняя свой естественный вид и цвет.", "bold": False},
            {"text": "3.3. Покупатель имеет право отказаться от Товара в случае любого отклонения от базовых показателей. Принятие Товара со скидкой — на усмотрение Покупателя, если такая опция возможна.", "bold": False},
            {"text": "3.4. В случае доставки автотранспортом Стороны согласны, что если качество Товара, установленное лабораторией Терминала, не соответствует допустимым отклонениям, результаты анализа лаборатории Терминала являются окончательными, не подлежат обжалованию и обязательны для обеих Сторон.", "bold": False},
            {"text": "3.5. В случае доставки по железной дороге, при несоответствии фактических показателей качества Товара и показателей качества, указанных в сертификате качества зерна, выданном при разгрузке Товара лабораторией Терминала, и требованиям качества, указанным в ГОСТ, Продавец не разгружает зерно и уведомляет Клиента о расхождениях по почте и принимает меры для урегулирования споров.", "bold": False},
            {"text": "В случае несогласия Продавца с результатами анализа лаборатории Терминала при доставке по железной дороге, Продавец заявляет о своём несогласии Покупателю и информирует о дальнейших действиях в отношении такого Товара. Продавец имеет право назначить своего представителя для повторного (арбитражного) отбора проб и анализа качества Товара в лаборатории Терминала (арбитражный анализ качества зерна может быть проведён в аккредитованной лаборатории Зерновой компании Украины). Результаты такого анализа являются окончательными и не подлежат обжалованию.", "bold": False},
            {"text": "Расходы, связанные с арбитражем для определения качества спорной партии Товара, включая избыточный простой вагонов, несёт и оплачивает Продавец.", "bold": False},
            {"text": "Независимо от понесённых расходов, Стороны согласны, что ответственность Покупателя ограничивается простоем на три дня включительно. В любом случае Продавец не имеет права оставлять вагоны и несёт все расходы и убытки за время нахождения вагонов на железнодорожных путях, включая время независимых лабораторных исследований, независимо от результатов таких исследований.", "bold": False},
            {"text": "3.6. Покупатель имеет право отказаться от любого Товара, не соответствующего договорным параметрам качества, указанным в настоящем Контракте. В случае поставки некачественной партии Товара или несоответствия согласованным параметрам Покупатель имеет право:", "bold": False},
            {"text": "- Уменьшить цену Товара в соответствии с параметрами, определёнными в заключении лаборатории;", "bold": False},
            {"text": "- Применить скидку к цене поставленного Товара. Параметры для скидки определены в пункте 3.1 настоящего Контракта;", "bold": False},
            {"text": "- Компенсировать Покупателю расходы на доработку Товара до установленных параметров качества;", "bold": False},
            {"text": "- Поставить дополнительное количество Товара по сниженной цене;", "bold": False},
            {"text": "- Поставить/заменить Товар в соответствии с условиями, изложенными в Контракте;", "bold": False},
            {"text": "- Отказаться от приёмки и оплаты Товара, а также требовать компенсации всех расходов, включая, но не ограничиваясь, транспортно-логистическими услугами, штрафами и финансовыми санкциями, наложенными на Покупателя контрагентами (партнёрами по последующим Контрактам на поставку Товара) из-за таких недостатков или некачественного Товара. Покупатель также может требовать компенсации убытков, понесённых в результате приёмки некачественного Товара.", "bold": False},
            {"text": "3.7. Замена Товара осуществляется за счёт Продавца в течение 3 (трёх) рабочих дней с даты претензии Покупателя.", "bold": False},
            {"text": "3.8. При применении скидки на Товар уведомление о скидке направляется представителю Продавца по электронной почте или электронному каналу связи, указанному в реквизитах Контракта. После получения уведомления по электронной почте о необходимости применения скидки Продавец в течение одного (1) часа соглашается на скидку, если Товар доставляется автотранспортом. Если доставка осуществляется по железной дороге, Продавец либо соглашается на скидку, либо уведомляет Продавца о направлении своего представителя для совместного отбора проб и составления Акта несоответствия Товара. Если Продавец не отвечает в течение 1 часа после отправки электронного письма Покупателем, Покупатель самостоятельно принимает решение о скидке.", "bold": False},
            {"text": "3.9. В случае согласия на скидку Продавцом стороны согласны, что данными, используемыми для скидки из-за несоответствия качества и безопасности, являются результаты лабораторных исследований, проведённых на месте доставки или в независимой лаборатории, выбранной Покупателем, а также данные, зафиксированные в Акте несоответствия.", "bold": False},
            {"text": "3.10. Если Товар принимается по сниженной цене на основании данных Покупателя, Продавец обязуется оформить таможенную декларацию (ГТД) на основании данных о скидке, предоставленных Покупателем.", "bold": False},
            {"text": "3.11. В случае расхождений в количестве/качестве Товара Покупатель имеет право удержать оплату за всё количество недопоставленного/некачественного Товара до предоставления исправленных документов:", "bold": False},
            {"text": " 3.11.1. Данные, указанные в товарно-транспортной накладной (ТТН), с учётом замечаний Покупателя, если таковые имеются;", "bold": False},
            {"text": "  3.12.2. Данные лабораторных исследований, с учётом скидки.\n", "bold": False},
        ])
        return sections

    def render_price(self, price_per_ton, price_per_ton_text, total_value, total_value_text):
        return [
            {"text": "\n4. ЦЕНА:", "bold": True},
            {"text": f"4.1. Цена за одну метрическую тонну Товара составляет {price_per_ton} 00 долларов США ( {price_per_ton_text} USD).", "bold": False},
            {"text": f"4.2. Общая стоимость Товара по Контракту {total_value} 00 USD ({total_value_text} USD).", "bold": False},
        ]

    def render_all_sections(self, goods_description, incoterms_year, quantity, tolerance, metrics, price_per_ton, price_per_ton_text, total_value, total_value_text):
        sections = [
            {"text": self.render_parties().strip(), "bold": False},
            {"text": "\n1. ТОВАР: ", "bold": True},
            {"text": self.render_goods(goods_description, incoterms_year).strip(), "bold": False},
            {"text": "\n2. КОЛИЧЕСТВО: ", "bold": True},
        ]
        sections.extend(self.render_quantity_sections(quantity, tolerance))
        sections.extend(self.render_quality_sections(metrics))
        sections.extend(self.render_price(price_per_ton, price_per_ton_text, total_value, total_value_text))
        return split_sections(sections)

contract_template_russia = ContractTemplateRussia(
    contract_number="1234567890",
    date="2024-01-01",
    seller_name="ООО \"Лучшее Зерно\"",
    seller_representative="Иван Иванов",
    buyer_name="ООО \"АгроИмпорт\"",
    buyer_representative="Джон Смит",
)

if __name__ == "__main__":
    print(contract_template_russia.render_quantity_sections(1000, 5)) 