from t import split_sections

class ContractTemplateUkraine:
    def __init__(
        self,
        contract_number,
        date,
        seller_name,
        seller_representative,
        buyer_name,
        buyer_representative,
    ):
        self.contract_number = contract_number
        self.date = date
        self.seller_name = seller_name
        self.seller_representative = seller_representative
        self.buyer_name = buyer_name
        self.buyer_representative = buyer_representative

    def render_header(self):
        return (
            f"КОНТРАКТ № C-W {self.contract_number}\n"
            f"{self.date}"
        )

    def render_parties(self):
        return (
            f"Цей Контракт (надалі — \"Контракт\") укладено між компанією"
            f"{self.buyer_name}(\"Покупець\") в особі {self.buyer_representative}, що діє на підставі Статуту компанії, з однієї сторони, та {self.seller_name} (\"Продавець\") в особі директора {self.seller_representative}, що діє на підставі Статуту компанії.\n\n"
            f"Беручи до уваги умови, викладені в цьому документі, сторони домовилися про наступне:"
        )

    def render_goods(self, product_description, production_year):
        return (
            "1.1. У порядку та на умовах, визначених цим Контрактом, Продавець продає, а Покупець приймає та оплачує сільськогосподарську продукцію, а саме:\n"
            f"{product_description}, {production_year} року виробництва (надалі — \"Товар\").\n"
        )

    def render_quantity_sections(self, quantity, tolerance):
        return [
            {"text": "2.1. Одиниця виміру кількості Товару — метрична тонна (1000 кг).", "bold": False},
            {"text": f"2.2. Загальна кількість: {quantity} МТ +/- {tolerance}% на вибір Продавця.", "bold": False},
            {"text": "2.3. Вага поставленого Товару остаточно визначається за результатами зважування після прибуття на місце доставки. Вид транспорту: вантажний транспорт.", "bold": False},
            {"text": "2.4. Кількість Товару визначається за вагою під час розвантаження автотранспорту та/або залізничних вагонів на місці доставки: лабораторією Терміналу. Продавець має право призначити своїх представників, за власний рахунок, для контролю кількості Товару під час розвантаження. Якщо Продавець не забезпечить своєчасну присутність своїх представників, розвантаження вантажного транспорту буде здійснено без них, а дані про кількість розвантаженого Товару, визначені зважуванням на місці доставки, визнаються обома Сторонами Контракту.", "bold": False},
            {"text": "2.5. Якщо під час зважування вагона на станції призначення виявлено розбіжність між брутто-вагою у залізничній накладній та перевантаженою вагою понад 0,5%, Покупець повідомляє про таку розбіжність письмово протягом 1 (однієї) години, надіславши повідомлення на електронну адресу, зазначену в Контракті, а вагон розвантажується лише на підставі письмового дозволу, який Продавець надає протягом 4 (чотирьох) годин Покупцю, надіславши повідомлення на електронну адресу, зазначену в цьому Контракті. Покупець має право погодитися на місце, зазначене тут, або направити свого представника для контрольного зважування Товару, а представник Продавця прибуде протягом 12 годин з моменту повідомлення про нестачу.", "bold": False},
            {"text": "У разі недопоставки погодженої кількості Товару Продавець зобов'язується:", "bold": False},
            {"text": "-     поставити відсутній Товар протягом 3 днів;", "bold": False},
            {"text": "-   якщо оплата здійснена, повернути Покупцю кошти протягом 3 днів з дати відповідної вимоги Покупця.", "bold": False},
            {"text": "Додатково Покупець має право придбати відсутню кількість Товару у інших контрагентів. Продавець зобов'язаний компенсувати вартість такого Товару та транспортно-логістичні витрати протягом 3 днів з дати письмової вимоги Покупця.\n", "bold": False},
        ]

    def render_quality_sections(self, metrics: list[str]):
        sections = [
            {"text": "\n3. ЯКІСТЬ І СТАН ТОВАРУ:", "bold": True},
            {"text": "3.1. Якість Товару за цим Контрактом повинна відповідати наступним показникам:\n", "bold": False},
        ]
        for metric in metrics:
            sections.append({"text": metric, "bold": False})
        sections.extend([
            {"text": "Амброзія не приймається.", "bold": False},
            {"text": "Всі показники якості повинні визначатися відповідно до стандартів ISO, ICC та ЄС.", "bold": False},
            {"text": "3.2. Товар повинен бути високоякісним, лояльним і придатним для продажу, без сторонніх/неприємних запахів, без рицини або інших токсичних насіння. Крім того, Товар не повинен містити сторонніх тіл, таких як скло, метал тощо. Товар не повинен містити ГМО відповідно до нормативних актів і повинен відповідати стандартам ЄС щодо пестицидів/залишків/важких металів і мікотоксинів. Товар повинен бути без живих комах, без сторонніх запахів або забруднень, зберігаючи свій природний вигляд і колір.", "bold": False},
            {"text": "3.3. Покупець має право відмовитися від Товару у разі будь-якого відхилення від базових показників. Прийняття Товару зі знижкою — на розсуд Покупця, якщо така опція можлива.", "bold": False},   
            {"text": "3.4. У разі доставки автотранспортом Сторони погоджуються, що якість Товару, встановлена лабораторією Терміналу, не відповідає допустимим відхиленням, результати аналізу лабораторії Терміналу є остаточними, не підлягають оскарженню і є обов'язковими для обох Сторін.", "bold": False},
            {"text": "3.5. У разі доставки залізницею, у разі невідповідності фактичних показників якості Товару та показників якості, зазначених у сертифікаті якості зерна, виданому при розвантаженні Товару лабораторією Терміналу, та вимогам якості, зазначеним у ДСТУ, Продавець не розвантажує зерно і повідомляє Клієнта про розбіжності поштою та вживає заходів для врегулювання спорів.", "bold": False},
            {"text": "У разі незгоди Продавця з результатами аналізу лабораторії Терміналу при доставці залізницею, Продавець заявляє про свою незгоду Покупцю та інформує про подальші дії щодо такого Товару. Продавець має право призначити свого представника для повторного (арбітражного) відбору проб і аналізу якості Товару в лабораторії Терміналу (арбітражний аналіз якості зерна може бути проведений в акредитованій лабораторії Зернової компанії України). Результати такого аналізу є остаточними і не підлягають оскарженню.", "bold": False},
            {"text": "Витрати, пов'язані з арбітражем для визначення якості спірної партії Товару, включаючи надмірний простій вагонів, несе і оплачує Продавець.", "bold": False},
            {"text": "Незалежно від понесених витрат, Сторони погоджуються, що відповідальність Покупця обмежується простоєм на три дні включно. У будь-якому випадку Продавець не має права залишати вагони і несе всі витрати та збитки за час перебування вагонів на залізничних коліях, включаючи час незалежних лабораторних досліджень, незалежно від результатів таких досліджень.", "bold": False},
            {"text": "3.6. Покупець має право відмовитися від будь-якого Товару, що не відповідає договірним параметрам якості, зазначеним у цьому Контракті. У разі поставки неякісної партії Товару або невідповідності погодженим параметрам Покупець має право:", "bold": False},
            {"text": "- Зменшити ціну Товару відповідно до параметрів, визначених у висновку лабораторії;", "bold": False},
            {"text": "- Застосувати знижку до ціни поставленого Товару. Параметри для знижки визначені у пункті 3.1 цього Контракту;", "bold": False},
            {"text": "- Компенсувати Покупцю витрати на доопрацювання Товару до встановлених параметрів якості;", "bold": False},
            {"text": "- Поставити додаткову кількість Товару за зниженою ціною;", "bold": False},
            {"text": "- Поставити/замінити Товар відповідно до умов, викладених у Контракті;", "bold": False},
            {"text": "- Відмовитися від приймання та оплати Товару, а також вимагати компенсації всіх витрат, включаючи, але не обмежуючись, транспортно-логістичними послугами, штрафами та фінансовими санкціями, накладеними на Покупця контрагентами (партнерами за наступними Контрактами на поставку Товару) через такі недоліки або неякісний Товар. Покупець також може вимагати компенсації збитків, понесених у результаті приймання неякісного Товару.", "bold": False},
            {"text": "3.7. Заміна Товару здійснюється за рахунок Продавця протягом 3 (трьох) робочих днів з дати претензії Покупця.", "bold": False},
            {"text": "3.8. При застосуванні знижки на Товар повідомлення про знижку надсилається представнику Продавця електронною поштою або електронним каналом зв'язку, зазначеним у реквізитах Контракту. Після отримання повідомлення електронною поштою про необхідність застосування знижки Продавець протягом однієї (1) години погоджує знижку, якщо Товар доставляється автотранспортом. Якщо доставка здійснюється залізницею, Продавець або погоджує знижку, або повідомляє Продавцю про направлення свого представника для спільного відбору проб і складання Акту невідповідності Товару. Якщо Продавець не відповідає протягом 1 години після відправлення електронного листа Покупцем, Покупець самостійно приймає рішення щодо знижки.", "bold": False},
            {"text": "3.9. У разі погодження знижки Продавцем сторони погоджуються, що даними, які використовуються для знижки через невідповідність якості та безпеки, є результати лабораторних досліджень, проведених на місці доставки або в незалежній лабораторії, обраній Покупцем, а також дані, зафіксовані в Акті невідповідності.", "bold": False},
            {"text": "3.10. Якщо Товар приймається за зниженою ціною на підставі даних Покупця, Продавець зобов'язується оформити митну декларацію (ВМД) на підставі даних про знижку, наданих Покупцем.", "bold": False},
            {"text": "3.11. У разі розбіжностей у кількості/якості Товару Покупець має право утримати оплату за всю кількість недопоставленого/неякісного Товару до надання виправлених документів:", "bold": False},
            {"text": " 3.11.1. Дані, зазначені у товарно-транспортній накладній (ТТН), з урахуванням зауважень Покупця, якщо такі є;", "bold": False},
            {"text": "  3.12.2. Дані лабораторних досліджень, з урахуванням знижки.\n", "bold": False},
        ])
        return sections

    def render_delivery_sections(self, delivery_start_date="00.00.2025", delivery_end_date="00.00.2025", exporter_name="_______________________", edrpou_code="________", delivery_address="Одеська область, Одеський район, порт Південний, причал№17,ТОВ «ТІС-МІНДОБРИВА» або порт Південний, причал№16, ТОВ «ТІС-МІНДОБРИВА»"):
        sections = [
            {"text": "\n5. УМОВИ І ТЕРМІНИ ПОСТАВКИ:", "bold": True},
            {"text": "5.1. Продавець вважається таким, що здійснив поставку Товару, коли Товар надано в розпорядження Покупця в місці визначеному Сторонами в даному Контракті, очищений від митних зборів, необхідних для ввезення, на прибулому транспортному засобі, готовому до розвантаження в зазначеному місці призначення.", "bold": False},
            {"text": "5.2. Продавець несе всі витрати і ризики, пов'язані з доставкою Товару в місце призначення, і зобов'язаний виконати митні формальності, необхідні для ввезення, сплатити будь-які збори, що стягуються під час ввезення, а також виконати всі митні формальності.", "bold": False},
            {"text": f"5.3. Постачання Товару буде здійснено на умовах  DAP. Дата поставки : з {delivery_start_date} р. по {delivery_end_date} р. обидві дати включно. Товар може поставлятися партіями. За день до поставки Товару Продавець повідомляє на електронну адресу Покупця про поставку відповідної партії Товару.", "bold": False},
            {"text": "5.4. Упаковка: 100% насипом.", "bold": False},
            {"text": "5.5. Вантажний автотранспорт повинен супроводжуватись наступними діючими документами:", "bold": False},
            {"text": "⮚   належно оформлена авто (товарно-транспортна) накладна на кожен вантажний автотранспорт, заповнена Продавцем відповідно до інструкцій Покупця;", "bold": False},
            {"text": "5.6. Залізничні вагони повинні супроводжуватись наступними діючими документами:", "bold": False},
            {"text": "⮚   Залізничні квитанції/накладні на кожен день залізничний вагон відповідно до інструкції Покупця;", "bold": False},
            {"text": "⮚   Посвідчення про якість зерна (форма 42), виданий елеватором або зерновим складом в Пункті відвантаження Товару.", "bold": False},
            {"text": "5.7. Продавець повинен:", "bold": False},
            {"text": "a) укласти відповідний договір у порту з акредитованим митним брокером Покупця та проводити митне оформлення Товару за свій рахунок відповідно до інструкцій Покупця; Контактні дані митного брокера Покупця для з'ясування питань щодо митного оформлення: +380952892570;", "bold": False},
            {"text": "b) на власний страх і ризик і власним коштом отримати будь-яку експортну ліцензію, оформити сертифікат походження Товару, а також виконати всі митні формальності, необхідні для експорту Товару. Продавець надає Експедитору та митному брокеру в порту для митного оформлення Товару всі запитувані без виключення документи в терміни, які вказує Експедитор (митний брокер). Надані відомості або документи, які мають неточності або надання неповного пакету документів вважаються такими, що не надані Експедитору (митному брокеру). Датою одержання документів вважається дата їх вручення Експедитору (митному брокеру).", "bold": False},
            {"text": "5.8. Покупець повинен надати Продавцю всі необхідні документарні інструкції для заповнення транспортних документів шляхом надсилання електронною поштою;", "bold": False},
            {"text": "5.9. Здійснення поставок за даним Контрактом можливе лише після проходження Продавцем/Експортером акредитації у Покупця.", "bold": False},
            {"text": "5.10. Для поставок залізничним транспортом:", "bold": False},
            {"text": "Продавець по електронній пошті направляє Покупцю графік відвантаження. Покупець узгоджує наданий графік з терміналом в місці поставки та Продавцем, у випадку внесення змін у цей графік. Продавець зобов'язується здійснювати поставку Товару лише у відповідності до узгодженого графіку. Графік відвантаження має бути пропорційним до періоду поставки, якщо інше не погодять Сторони. Продавець уповноважує свого вантажовідправника надати Покупцю номер своєї заявки, зареєстрованої в АС Месплан за 7 (сім) днів до початку відвантаження. Покупець зобов'язаний організувати підтвердження даної заявки в АС Месплан з боку станції призначення та вантажоодержувача/Терміналу протягом 2 днів з моменту надання номера заявки. У разі непогодження електронної заявки або погодження не в повному обсязі, або конвенції, введеної Державною адміністрацією залізничного транспорту України (Українські залізниці) та опубліковані на сайті https://uz.gov.ua/, сроки поставки Товару продовжуються на строк не погодження та/або дії конвенції.", "bold": False},
            {"text": "5.11. Продавець щоденно направляє на адресу Покупця електронною поштою добовий звіт про відвантажений Товар (згідно зразка, наданого разом з інструкціями) із зазначенням наступної інформації:", "bold": False},
            {"text": "- Номер даного Контракту;", "bold": False},
            {"text": "- Назву Експортера;", "bold": False},
            {"text": "- Дата відвантаження;", "bold": False},
            {"text": "- Станція відправлення та станція призначення;", "bold": False},
            {"text": "- Номер вагона/автомобіля;", "bold": False},
            {"text": "- Номер залізничної накладної/авто ТТН;", "bold": False},
            {"text": "- Назву та вагу (брутто, тара, нетто) вантажу; Скановані копії супровідних документів (Посвідчення про якість зерна (форма 42).", "bold": False},
            {"text": f"5.12. Експортери Товару за даним Контрактом: {exporter_name}, код ЄДРПОУ:{edrpou_code}. Зміна Експортера відбувається за згодою обох Сторін шляхом укладання Додаткової угоди до даного Контракту. Продавець надає Покупцю листи від зазначених у цьому пункті Експортерів про їх згоду здійснити відвантаження та експорт Товару. Якщо Продавець не є резидентом України, Продавець підтверджує, що Товар, поставлений за цим Контрактом, було придбано безпосередньо в Експортера. Продавець надає гарантійний лист від зазначених у цьому пункті Експортерів про перехід субсидіарної відповідальності від Продавця до Експедитора у разі порушення або невиконання Покупцем своїх зобов'язань за даним Контрактом.", "bold": False},
            {"text": "5.13.У разі прибуття залізничним або автомобільним транспортом на адресу Покупця некондиційного Товару (завантажений, спечений Товар, наявність домішок) Покупець забезпечує складання актів, на підставі яких Продавець відшкодовує додаткові витрати, пов'язані з вивантаженням, прийманням, зберіганням та повернення такого Товару, включаючи простій вагонів. Вагони із залишками кількостей фумігантів прийматися не будуть і повинні бути переадресовані Продавцем протягом 3 (трьох) діб  з моменту повідомлення Покупцем. У разі виявлення вагонів із залишками фумігації Покупець має право виставити рахунок на сплату штрафу Продавцю у розмірі 300, 00(триста) доларів США за вагон на добу, а Продавець зобов'язаний сплатити такий штраф протягом 5 (п'яти) банківських днів з моменту виставлення рахунку. Продавець зобов'язаний розпорядитися неконденційним Товаром протягом 3 ( трьох) днів з моменту повідомлення Покупцем. У разі порушення встановленого цим пунктом терміну для розпорядження некондинційним Товаром Продавець повинен сплатити Покупець штрафні санкції у сумі 300,00 (триста) доларів США за кожен вагон на добу з моменту сполучення та до повернення Товару, та відшкодувати Покупцю всі понесені збитки  документально підтверджених витрат у зв'язку з таким порушенням.", "bold": False},
            {"text": "5.14. Продавець та Експортер гарантує, що Товар який постачається :", "bold": False},
            {"text": "- на момент підписання цього Контракту, а також на момент переходу права власності на Товар від Продавця до Покупця, компетентними органами Продавця не приймаються і не будуть прийматися рішення про накладення будь-яких обтяжень на Товар (його частину), а також рішення щодо відчуження Товару;", "bold": False},
            {"text": "- на момент підписання цього Контракту, а також на момент переходу права власності на Товар від Продавця до Покупця, Товар не знаходиться та не буде знаходитися в податковій заставі, у спорі і під забороною на відчуження;", "bold": False},
            {"text": "- на момент підписання цього Контракту, а також на момент переходу права власності на Товар від Продавця до Покупця, Товар не буде продано, подаровано, відступлено, обміняно, виділено зі складу активів Продавця або закладено, передано в управління, а також не буде передано в оренду (користування) цілком або частинами;", "bold": False},
            {"text": "- на момент підписання цього Контракту, а також на момент переходу права власності на Товар від Продавця на Покупця, Товар перебуває в доброму стані та по-суті відповідає цілям, для яких воно призначено, та не містить жодних речовин або матеріалів, що мають недоліки або становлять ризик для здоров'я або безпеки;", "bold": False},
            {"text": "- на момент підписання цього Контракту, а також на момент переходу права власності на Товар від Продавця до Покупця, у Продавця відсутні які-небудь зобов'язання, термін яких наступив або наступить у майбутньому (у т.ч. по попередніх контрактах, офертах, опціонах тощо) по відчуженню Товару, передачі окремих прав (право користування, право розпорядження, право володіння) на Товар;", "bold": False},
            {"text": "- Товар є вільним від будь-яких прав та претензій третіх осіб, а також від будь-яких інших обмежень чи обтяжень будь-якого характер.", "bold": False},
            {"text": "Продавець та Експортер також підтверджує, що походження Товару не є з Донецької області, Луганської області, Запорізької області, Херсонської області, Автономної Республіки Крим та інших тимчасово окупованих територій України.", "bold": False},
            {"text": "Продавець та Експортер не зареєстровані та не здійснюють господарську діяльність на зазначених тимчасово окупованих територіях України.", "bold": False},
            {"text": "У разі виявлення факту, що Товар має походження з вказаних регіонів, Постачальник та Експортер зобов'язані повністю відшкодувати Покупцю всі понесені витрати та збитки, що можуть виникнути у зв'язку з постачанням такого Товару.", "bold": False},
            {"text": "5.15. Постачальник зобов'язується зареєструвати ПМД протягом 3-х днів з дати настання першої події: постачання або оплати за кожну партію Товару, але в будь якому випадку за 3 дні до закінчення терміну поставки повної партії Товару.", "bold": False},
            {"text": f"5.16. Постачальник самостійно оплачує вартість реєстрації автомобілю у розмірі 500 грн., при відвантаженні Товару до {delivery_address}", "bold": False},
        ]
        return sections

    def render_price(self, price_per_ton, price_per_ton_text, total_value, total_value_text):
        return [
            {"text": "\n4. ЦІНА:", "bold": True},
            {"text": f"4.1. Ціна за одну метричну тонну Товару становить {price_per_ton} 00 доларів США ( {price_per_ton_text} USD).", "bold": False},
            {"text": f"4.2. Загальна вартість Товару за Контрактом {total_value} 00 USD ({total_value_text} USD).", "bold": False},
        ]

    def render_all_sections(self, goods_description, incoterms_year, quantity, tolerance, metrics, price_per_ton, price_per_ton_text, total_value, total_value_text, delivery_start_date="00.00.2025", delivery_end_date="00.00.2025", exporter_name="_______________________", edrpou_code="________", delivery_address="Одеська область, Одеський район, порт Південний, причал№17,ТОВ «ТІС-МІНДОБРИВА» або порт Південний, причал№16, ТОВ «ТІС-МІНДОБРИВА»"):
        sections = [
            {"text": self.render_parties().strip(), "bold": False},
            {"text": "\n1. ТОВАР: ", "bold": True},
            {"text": self.render_goods(goods_description, incoterms_year).strip(), "bold": False},
            {"text": "\n2. КІЛЬКІСТЬ: ", "bold": True},
        ]
        sections.extend(self.render_quantity_sections(quantity, tolerance))
        sections.extend(self.render_quality_sections(metrics))
        sections.extend(self.render_price(price_per_ton, price_per_ton_text, total_value, total_value_text))
        sections.extend(self.render_delivery_sections(delivery_start_date, delivery_end_date, exporter_name, edrpou_code, delivery_address))
        return split_sections(sections)


contract_template_ukraine = ContractTemplateUkraine(
    contract_number="1234567890",
    date="2024-01-01",
    seller_name="ТОВ \"Кращий Зерно\"",
    seller_representative="Іван Іванов",
    buyer_name="ТОВ \"АгроІмпорт\"",
    buyer_representative="Джон Сміт",
)

if __name__ == "__main__":
    print(contract_template_ukraine.render_quantity_sections(1000, 5)) 